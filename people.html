<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apple Photos Peoples Ridgeline</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" href="css/main.css" />
<style>
body { padding-bottom: 3em; }
</style>
</head>
<body>
<div class="container-fluid">
    <div class="header-nav"></div>
    <div id="people-graph"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
<script>
let peopleData;
let canvas;

$(document).ready(() => {
    $('.header-nav').load('navigation.html', ()=> {
        $('#nav-people-ridgeline').addClass('active');
    });

    $.ajax({
        type: "GET",
        url: "outdata/people_data.json",
        success: function (data) {
            peopleData = data;
            
            let width = data.dates.length;
            let height = data.series.length * 10;
            // resizeCanvas(, );

            console.log(data);
            startRender();
        }
    });
});

// Global properties
const g = {
    bg_color: "#fff",
    border_width: 1,
    border_color: "#888",
    dotsize: 5
};

function startRender() {
    // https://stackoverflow.com/questions/39711941/p5-js-manually-call-setup-and-draw
    const sketch = (p)=> {

        // Setup canvas size from data size
        const date_size = peopleData.dates.length;
        const people_size = peopleData.series.length;
        console.log("Data loaded with " + date_size + " dates and " + people_size + " people");
        
        p.setup = ()=> {

            // Calculate canvas size based on config
            const canvas_width = date_size + 2 * g.border_width;
            const canvas_height = people_size + 2 * g.border_width;
            p.createCanvas(canvas_width, canvas_height);
            p.noLoop();
            
            // Draw border and clear screen
            p.background(g.border_color);
            p.fill(g.bg_color);
            p.rect(1, 1, date_size, people_size);

        }
        p.draw = ()=> {
            p.noStroke();
            p.fill(0, 50);
            for (let i = 0; i < peopleData.series.length; i++) {
                const name = peopleData.series[i].name;
                const personData = peopleData.series[i].values;

                for (let j = 0; j < personData.length; j++) {
                    if (personData[j] == 0) {
                        continue;
                    }
                    p.ellipse(j, i, g.dotsize, g.dotsize);
                }
            }
        }
    }

    let myp5 = new p5(sketch, document.getElementById('people-graph'));
}


</script>
</body>
</html>