<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apple Photos Peoples Ridgeline</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" href="css/main.css" />
<style>
body { padding-bottom: 3em; }
#people-graph canvas {
    margin-right: 1em;;
    border: 1px solid red;
}
#people-graph {
    box-shadow: rgba(0, 0, 0, 0.4) 0px 2px 4px, rgba(0, 0, 0, 0.3) 0px 7px 13px -3px, rgba(0, 0, 0, 0.2) 0px -3px 0px inset;
    overflow-x: scroll;
    padding: 2em 1em;
}
</style>
</head>
<body>
<div class="container-fluid">
    <div class="header-nav"></div>
    <div id="people-graph"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
<script>
let peopleData;
let canvas;

$(document).ready(() => {
    $('.header-nav').load('navigation.html', ()=> {
        $('#nav-people-ridgeline').addClass('active');
    });

    $.ajax({
        type: "GET",
        url: "outdata/people_data.json",
        success: function (data) {
            peopleData = data;
            
            let width = data.dates.length;
            let height = data.series.length * 10;
            // resizeCanvas(, );

            console.log(data);
            startRender();
        }
    });
});

// Global properties
const g = {
    bg_color: "#fff",
    border_width: 1,
    border_color: "#888",
    padding: 10,
    dotsize: 5
};

function calculateCanvasWidth(data_width) {
    return data_width + 2 * (
        g.border_width + g.padding
    );
}

function calculateCanvasHeight(data_height) {
    return data_height + 2 * (
        g.border_width + g.padding
    );
}

function startRender() {

    const date_size = peopleData.dates.length;
    const people_size = peopleData.series.length;
    console.log("Data loaded with " + date_size + " dates and " + people_size + " people");

    function drawBorder(p) {
        p.stroke(g.border_color);
        p.strokeWeight(1);
        p.noFill();
        p.rect(g.padding, g.padding, date_size, people_size);
    }

    function plotPeopleData(p) {
        p.push();
        p.translate(g.padding, g.padding);
        p.noStroke();
        p.fill(0, 50);
        for (let i = 0; i < peopleData.series.length; i++) {
            const name = peopleData.series[i].name;
            const personData = peopleData.series[i].values;

            for (let j = 0; j < personData.length; j++) {
                if (personData[j] == 0) {
                    continue;
                }
                p.ellipse(j, i, g.dotsize, g.dotsize);
            }
        }
        p.pop();
    }

    const sketch = (p)=> {

        // Setup canvas size from data size
        p.setup = ()=> {
            
            // Calculate canvas size based on config
            const canvas_width = calculateCanvasWidth(date_size);
            const canvas_height = calculateCanvasHeight(people_size);

            p.createCanvas(canvas_width, canvas_height);
            p.noLoop();
            
            // Draw border and clear screen
            p.background(g.bg_color);
            

        }

        p.draw = ()=> {
            drawBorder(p);
            plotPeopleData(p);
        }
    }

    let myp5 = new p5(sketch, document.getElementById('people-graph'));
}


</script>
</body>
</html>